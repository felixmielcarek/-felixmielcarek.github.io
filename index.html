<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="styles/styles.css">
    <title>Big Brother</title>
</head>
<body>
    <div>Welcome to Big Brother</div>

    <form id="logForm">
        <input type="submit" value="Log In" />
    </form>
    
    <script>
        function generateRandomString(length) {
            const charset = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let randomString = '';
            for (let i = 0; i < length; i++) {
                const randomIndex = Math.floor(Math.random() * charset.length);
                randomString += charset[randomIndex];
            }
            return randomString;
        }

        document.getElementById("logForm").addEventListener("submit", function(event) {
            event.preventDefault();

            state = generateRandomString(16);

            const params = new URLSearchParams();
            params.append('response_type', 'code');
            params.append('client_id', '5ec7f30903414033a3381995754da3e8');
            params.append('scope', 'user-read-private user-read-email user-library-read user-library-modify');
            params.append('redirect_uri', 'https://felixmielcarek.github.io/callback/');
            params.append('state', state);

            let queryUrl = 'https://accounts.spotify.com/authorize?' + params.toString();
    
            document.getElementById("logForm").action = queryUrl;
            document.getElementById("logForm").submit();
        });
    </script>
</body>
</html>
